<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Garden Defense</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#222;color:#fff;text-align:center}
#menu{padding:40px}
button{padding:10px 16px;margin:6px;font-size:16px;border:none;border-radius:6px;cursor:pointer}
#game{display:none;margin:20px auto;width:720px;height:360px;background:#7cfc98;border:4px solid #2c3e50;position:relative}
.grid{display:grid;grid-template-columns:repeat(9,80px);grid-template-rows:repeat(3,120px)}
.cell{border:1px solid rgba(0,0,0,.2);position:relative}
.plant{width:60px;height:60px;border-radius:50%;background:#2ecc71;margin:30px auto}
.bullet{width:12px;height:6px;background:#f1c40f;position:absolute;border-radius:3px}
.zombie{width:60px;height:90px;background:#27ae60;border-radius:10px;position:absolute}
#hud{margin:10px}
</style>
</head>
<body>

<div id="menu">
  <h1>üå± Garden Defense</h1>
  <p>Escolha o mapa:</p>
  <button onclick="setMap('day')">üå§Ô∏è Dia</button>
  <button onclick="setMap('night')">üåô Noite</button>
  <button onclick="setMap('fog')">üå´Ô∏è Neblina</button>
</div>

<div id="hud">Energia: <span id="energy">100</span></div>
<div id="game">
  <div class="grid" id="grid"></div>
</div>

<audio id="bgm" src="sounds/bgm.mp3" loop></audio>
<audio id="shootSound" src="sounds/shoot.mp3"></audio>
<audio id="dieSound" src="sounds/die.mp3"></audio>

<script>
const rows=3, cols=9;
let energy=100;
let enemies=[];
const gridEl=document.getElementById('grid');
const game=document.getElementById('game');

function setMap(type){
  document.getElementById('menu').style.display='none';
  game.style.display='block';
  if(type==='night') game.style.background='#2c3e50';
  if(type==='fog') game.style.background='#95a5a6';
  document.getElementById('bgm').volume=0.4;
  document.getElementById('bgm').play();
  startGame();
}

function startGame(){
  gridEl.innerHTML='';
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const cell=document.createElement('div');
      cell.className='cell';
      cell.onclick=()=>placePlant(r,c,cell);
      gridEl.appendChild(cell);
    }
  }
  spawnZombie();
}

function placePlant(r,c,cell){
  if(energy<50 || cell.querySelector('.plant')) return;
  energy-=50;
  document.getElementById('energy').innerText=energy;
  const p=document.createElement('div');
  p.className='plant';
  cell.appendChild(p);
  setInterval(()=>shoot(r,cell),1200);
}

function shoot(row,cell){
  const target=enemies.find(e=>e.row===row && e.x-cell.offsetLeft<400 && e.x>cell.offsetLeft);
  if(!target) return;
  document.getElementById('shootSound').play();
  const b=document.createElement('div');
  b.className='bullet';
  let x=cell.offsetLeft+60;
  const y=cell.offsetTop+60;
  b.style.left=x+'px';b.style.top=y+'px';
  game.appendChild(b);
  const move=setInterval(()=>{
    x+=6;b.style.left=x+'px';
    if(x>target.x){
      target.life-=20;
      b.remove();clearInterval(move);
      if(target.life<=0) killZombie(target);
    }
    if(x>game.offsetWidth){b.remove();clearInterval(move)}
  },30);
}

function spawnZombie(){
  const z=document.createElement('div');
  z.className='zombie';
  const row=Math.floor(Math.random()*rows);
  let x=game.offsetWidth;
  const y=row*120+20;
  z.style.left=x+'px';z.style.top=y+'px';
  game.appendChild(z);
  const enemy={el:z,row,x,life:60};
  enemies.push(enemy);
  enemy.timer=setInterval(()=>{
    x-=1;enemy.x=x;z.style.left=x+'px';
    if(x<0){alert('Game Over');location.reload();}
  },30);
}

function killZombie(e){
  document.getElementById('dieSound').play();
  clearInterval(e.timer);
  e.el.remove();
  enemies=enemies.filter(x=>x!==e);
}
</script>
</body>
</html>
